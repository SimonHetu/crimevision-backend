generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


enum TimePeriod {
  jour
  nuit
  soir
}

enum Role {
  USER
  ADMIN
  MODERATOR
}


model Pdq {
  id              Int        @id
  name            String     @default("")
  address         String     @default("")
  cityCode        String     @default("")
  latitude        Float      @default(0)
  longitude       Float      @default(0)

  incidents Incident[]         
}

model Incident {
  id              Int       @id @default(autoincrement())
  source          String
  sourceId        Int

  @@unique([source, sourceId], name: "source_sourceId")
  category        String
  date            DateTime
  timePeriod      TimePeriod

  // Geometrie 
  x               Float?
  y               Float?
  longitude       Float?
  latitude        Float?

  // PDQ relation
  pdqId           Int
  pdq             Pdq       @relation(fields: [pdqId], references: [id]) 
}

/// Pour le suivi des incr√©ments d'import
model ImportCursor {
  source        String   @id
  lastDate      DateTime?
  lastSourceId  Int?
  lastRunAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model User {
  id              Int       @id @default(autoincrement())
  email           String    @unique
  name            String
  pseudo          String    @unique
  hashedPassword  String
  role            Role      @default(USER)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @default(now()) @updatedAt

}
